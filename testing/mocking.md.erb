---
title: Mocking
slides: true
---
:h3 Overview

* SUT ("System under test")
* Collaborators (other objects needed to test SUT)
* Decoupling is a major goal

:slide_title example

:source_begin :ruby
# code sketch, not valid code!

class Car
   def make
   def electric?
   def weight
   def image
   def current_price
end

class Garage
   def find_parking_space(car)
   def park_car(car, space)
   def contains_space(space)
end

class Space
    def is_free?
    def occupied?
    def charging_station?
    def occupying_car
end

#test
    c = Car.new(...)
    g = Garage.new(....)
    space = g.find_parking_space(c)
    assert space != nil
    g.park_car(c, space)
    assert space.occupied?

    1..10.times do
      car = Car.new(...)
      space = g.find_parking_space(car)
      g.park_car(car, space)
    end

:source_end

:slide_title What is a Mock?

* An object that stands in for another object during testing
* Make sure that only the right methods are called
* Related terms: Test Doubles, stubs, and others. Don't get confused.
* More distinctions
    1. Broadest term: Test Double. They are all part of this category
    1. Test Dummy: An object that stands in for another, that has no methods. Not very useful.
    1. Stub: Responds to the key methods that are required for the test but the return values are fixed.
    1. Spy: Like a Stub, except it "remembers" what calls were made so it can verify that the expected calls were indeed made.

:source_begin :ruby

    mock = Minitest::Mock.new
    mock.expect :apply, true

:source_end

:slide_title Advantages and Disadvantages

* Decoupling is always a good thing.
    1. Performance
    1. Maintainability
    1. Testability
* If you introduce a bug in a class
    1. Only the tests that are testing that class will fail
    1. So, fewer false positives
* Disadvantages
    1. Need to maintain to consistency between the mock and the class-being-mocked
    1. Otherwise you may be testing somethingn that doesn't even exist
* Real world example:
    1. Let's look at some of the code that runs this web site.
    1. Note slightly different syntax because of RSpec vs. minitest/spec
    1. [citem_spec.rb](https://github.com/pitosalas/coursegen/blob/master/spec/citem_spec.rb)
    1. [toc_spec.rb](https://github.com/pitosalas/coursegen/blob/master/spec/toc_spec.rb)
